# mosk-wikijs-backup


Восстановление (тестировалось ТОЛЬКО под mac os).


ВНИМАНИЕ
ВСЕ ПАРОЛИ УКАЗАННЫЕ КАК В ЭТОМ ДОКУМЕНТЕ ТАК И В САМОЙ WIKI НЕ ЯВЛЯЮТСЯ СЕКРЕТНЫМИ И
ЗАВЕДОМО ВЫБРАНЫ МАКСИМАЛЬНО ПРОСТЫМИ, НЕ ГОДЯТСЯ ДЛЯ PRODUCTION ENVIRONMENT!

1. Запустить Сервисы (в том числе базу, куда вливается бекап).

`docker-compose up -d` (или `docker-compose up`  если нужно наблюдлать логи)


2. Восстановить базу из дампа 
`${WORKDIR}` -  директория откуда будет происходить запуск, рекомендуется `/usr/local/wiki.js`

Восстановление дампа базы

```
    cd ${WORKDIR}
    docker-compose  \
        exec \
          db \
            pg_restore  -U wikijs -d wiki -c -v < wikibackup.dump
```
4 ошибки при выполнении не критичны, так как это ошибки удаления несуществующих таблиц,
и их можно игнорировать.


3. Перезапустить сервисы

`docker-compose down; docker-compose up -d`


4. В браузере: http://127.0.0.1:80/

  login: `superadmin@no-such-domain.tld`
  password: `superadmin`


5. После восстановления:
 * Рекомендуется настроить свой Elastisearch  и перенаправить на него настройки, или отключить, без этого не будет работать поиск.
 * Перенастроить репликацию данных в Git  на свой репозиторий.
 * По желанию - использовать systemd.unit  вместо ручного запуска.
